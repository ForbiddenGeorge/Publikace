<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: components/EditCardNavBarChangeContribution.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: components/EditCardNavBarChangeContribution.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState } from 'react';
import { useSelector } from 'react-redux';
import { EditCardNavBarChangeContributionMutation } from 'querries/EditCardNavBarChangeContributionMutation';
import { UpdateAuthorShare } from 'features/PublicationSlice';
import { useDispatch } from 'react-redux';
import AlertPositive from './AlertPositive';
import AlertNegative from './AlertNegative';

/**
   * Komponenta pro změnu podílu autorů na publikaci.
   *
   * @param {string} publicationId - ID publikace.
   * 
   * @returns {JSX.Element} - The rendered component
   */
function EditCardNavBarChangeContribution({ publicationId }) {
  
  const publications = useSelector((state) => state.publications);
  const publication = publications.find((pub) => pub.id === publicationId.publicationId);
  const [authors, setAuthors] = useState(publication ? [...publication.authors] : []);
  const dispatch = useDispatch();
  
  const [showAlert, setShowAlert] = useState(false);
  const [showAlert1, setShowAlert1] = useState(false);

  // predelat na async function (parametr bude authors) (=> dispatch)
  const handleSave = () => {
    let suma = 0;
    authors.forEach((celek) => {
      suma += celek.share;
    });
    const sum = Number(suma.toFixed(1));
    console.log('Celkem: ', sum);
    if (sum === 1) {
      console.log('Updated authors:', authors);
      authors.forEach((Contributor) => {
        console.log('Mutation called', Contributor);
        EditCardNavBarChangeContributionMutation({
          userId: Contributor.id,
          userShare: Contributor.share,
          lastchange: Contributor.lastchange,
          order: Contributor.order
        });
        console.log('Mutation finished');
        dispatch(UpdateAuthorShare({ publicationId: publication.id, authorId: Contributor.id, newShare: Contributor.share }));
      });

      setShowAlert(true);
    } else {
      setShowAlert1(true);
      console.log('Total sum must be equal to one. Yours is:', sum);
    }
  };

  const Logging = (event, authorIndex) => {
    const share = parseFloat(event.target.value);
    const updatedAuthors = [...authors];
    updatedAuthors[authorIndex] = { ...updatedAuthors[authorIndex], share };
    setAuthors(updatedAuthors);
  };

  const handleCloseAlert = () => {
    setShowAlert(false);
    setShowAlert1(false);
  };

  return (
    &lt;div className="container">
      {publication &amp;&amp; (
        &lt;div>
          {publication.authors.map((author, index) => {
            const shareValue = authors[index]?.share || 0; // Initialize share value with a default of 0 if it is undefined
            return (
              &lt;div key={author.id} className="card mb-2 p-2">
                &lt;div className="row">
                  &lt;div className="col-10">
                    &lt;h5>
                      {author.user.name} {author.user.surname}
                    &lt;/h5>
                  &lt;/div>
                  &lt;div className="col-2">
                    &lt;div key={author.id}>
                      &lt;h5>{shareValue}&lt;/h5>
                    &lt;/div>
                  &lt;/div>
                &lt;/div>
                &lt;div className="row">
                  &lt;label htmlFor="customRange3" className="form-label">
                    Podíl na publikaci
                  &lt;/label>
                  &lt;input
                    type="range"
                    className="form-range 90% m-2 border-success"
                    min="0"
                    max="1"
                    step="0.1"
                    id="customRange3"
                    value={shareValue}
                    onChange={(event) => Logging(event, index)}
                  />
                &lt;/div>
              &lt;/div>
            );
          })}
        &lt;/div>
      )}
      &lt;button type="button" className="btn bg-success text-white" onClick={handleSave}>
        Uložit změny
      &lt;/button>
      {showAlert &amp;&amp; &lt;AlertPositive info={"Nové podíly úspěšně uloženy"} onClose={handleCloseAlert} />}
      {showAlert1 &amp;&amp; &lt;AlertNegative info={"Celkový podíl nemůže přesáhnout 100%"} onClose={handleCloseAlert} />}
    &lt;/div>
  );
}

export default EditCardNavBarChangeContribution;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AddPublicationModal">AddPublicationModal</a></li><li><a href="global.html#AddPublicationModalInsertUsers">AddPublicationModalInsertUsers</a></li><li><a href="global.html#EditCard">EditCard</a></li><li><a href="global.html#EditCardNavBar">EditCardNavBar</a></li><li><a href="global.html#EditCardNavBarAddAuthor">EditCardNavBarAddAuthor</a></li><li><a href="global.html#EditCardNavBarAddAuthorSelect">EditCardNavBarAddAuthorSelect</a></li><li><a href="global.html#EditCardNavBarChangeContribution">EditCardNavBarChangeContribution</a></li><li><a href="global.html#EditCardNavBarEditInfo">EditCardNavBarEditInfo</a></li><li><a href="global.html#EditCardNavBarOrderOfAuthors">EditCardNavBarOrderOfAuthors</a></li><li><a href="global.html#PublicationCard">PublicationCard</a></li><li><a href="global.html#PublicationCardAuthors">PublicationCardAuthors</a></li><li><a href="global.html#PublicationCardInfo">PublicationCardInfo</a></li><li><a href="global.html#PublicationCardName">PublicationCardName</a></li><li><a href="global.html#SaveEditedPublication">SaveEditedPublication</a></li><li><a href="global.html#authorizedFetch">authorizedFetch</a></li><li><a href="global.html#name">name</a></li><li><a href="global.html#query">query</a></li><li><a href="global.html#reducer">reducer</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.2</a> on Fri Jul 14 2023 07:59:10 GMT+0200 (středoevropský letní čas)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
